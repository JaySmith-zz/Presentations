This solution is very similiar to the first one, but is an attempt to solve the multiple file approach.  It also comes with a few